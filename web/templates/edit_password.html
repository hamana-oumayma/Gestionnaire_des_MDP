<!-- templates/edit_password.html -->
{% extends "base.html" %}

{% block title %}Modifier le mot de passe - Password Manager{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">
        <div class="card">
            <div class="card-header">
                <h4 class="mb-0">Modifier le mot de passe</h4>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('edit_password', password_id=password.id) }}">
                    <div class="mb-3">
                        <label for="service" class="form-label">Service/Site Web *</label>
                        <input type="text" class="form-control" id="service" name="service" 
                               value="{{ password.service }}" required>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="username" class="form-label">Nom d'utilisateur *</label>
                            <input type="text" class="form-control" id="username" name="username" 
                                   value="{{ password.username }}" required>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="password" class="form-label">Mot de passe *</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="password" 
                                       name="password" value="{{ password.password }}" required>
                                <button class="btn btn-outline-secondary" type="button" 
                                        onclick="togglePasswordVisibility('password')">
                                    üëÅÔ∏è
                                </button>
                                <button class="btn btn-outline-primary" type="button" 
                                        onclick="generatePassword()">
                                    G√©n√©rer
                                </button>
                            </div>
                            <div class="mt-2">
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" 
                                           id="lowercase" checked>
                                    <label class="form-check-label" for="lowercase">Minuscules</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" 
                                           id="uppercase" checked>
                                    <label class="form-check-label" for="uppercase">Majuscules</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" 
                                           id="digits" checked>
                                    <label class="form-check-label" for="digits">Chiffres</label>
                                </div>
                                <div class="form-check form-check-inline">
                                    <input class="form-check-input" type="checkbox" 
                                           id="symbols">
                                    <label class="form-check-label" for="symbols">Symboles</label>
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="url" class="form-label">URL</label>
                        <input type="url" class="form-control" id="url" name="url" 
                               value="{{ password.url }}">
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label for="category" class="form-label">Cat√©gorie</label>
                            <select class="form-select" id="category" name="category">
                                <option value="Autre" {% if password.category == 'Autre' %}selected{% endif %}>Autre</option>
                                <option value="R√©seaux sociaux" {% if password.category == 'R√©seaux sociaux' %}selected{% endif %}>R√©seaux sociaux</option>
                                <option value="E-mail" {% if password.category == 'E-mail' %}selected{% endif %}>E-mail</option>
                                <option value="Banque" {% if password.category == 'Banque' %}selected{% endif %}>Banque</option>
                                <option value="Shopping" {% if password.category == 'Shopping' %}selected{% endif %}>Shopping</option>
                                <option value="Travail" {% if password.category == 'Travail' %}selected{% endif %}>Travail</option>
                                <option value="Jeux" {% if password.category == 'Jeux' %}selected{% endif %}>Jeux</option>
                            </select>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label for="strength" class="form-label">Force du mot de passe</label>
                            <div class="progress" style="height: 25px;">
                                <div class="progress-bar 
                                    {% if password.strength_score >= 80 %}bg-success
                                    {% elif password.strength_score >= 50 %}bg-warning
                                    {% else %}bg-danger{% endif %}" 
                                    role="progressbar" 
                                    style="width: {{ password.strength_score }}%">
                                    {{ password.strength_score }}/100
                                </div>
                            </div>
                            <small class="text-muted">
                                {% if password.breach_count > 0 %}
                                    ‚ö†Ô∏è Ce mot de passe a √©t√© trouv√© dans {{ password.breach_count }} fuites de donn√©es
                                {% else %}
                                    ‚úÖ Ce mot de passe n'a pas √©t√© trouv√© dans des fuites connues
                                {% endif %}
                            </small>
                        </div>
                    </div>
                    
                    <div class="mb-3">
                        <label for="notes" class="form-label">Notes</label>
                        <textarea class="form-control" id="notes" name="notes" 
                                  rows="3">{{ password.notes }}</textarea>
                    </div>
                    
                    <div class="d-flex justify-content-between">
                        <a href="{{ url_for('view_passwords') }}" class="btn btn-secondary">
                            Annuler
                        </a>
                        <button type="submit" class="btn btn-primary">
                            Mettre √† jour
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>

<script>
function togglePasswordVisibility(inputId) {
    const input = document.getElementById(inputId);
    input.type = input.type === 'password' ? 'text' : 'password';
}

async function generatePassword() {
    const length = 16;
    const lowercase = document.getElementById('lowercase').checked;
    const uppercase = document.getElementById('uppercase').checked;
    const digits = document.getElementById('digits').checked;
    const symbols = document.getElementById('symbols').checked;
    
    const response = await fetch('/api/generate', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({
            length: length,
            lowercase: lowercase,
            uppercase: uppercase,
            digits: digits,
            symbols: symbols
        })
    });
    
    const data = await response.json();
    if (data.success) {
        document.getElementById('password').value = data.password;
        // V√©rifier le mot de passe g√©n√©r√©
        checkPassword(data.password);
    }
}

async function checkPassword(password) {
    const response = await fetch('/api/check', {
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
        },
        body: JSON.stringify({ password: password })
    });
    
    const data = await response.json();
    if (data.success) {
        // Vous pourriez mettre √† jour l'affichage de la force ici
        console.log('Force:', data.strength, 'Fuite:', data.breach_count);
    }
}
</script>
{% endblock %}
